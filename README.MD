
#Использование git

##Структура GIT - репозитория

Репозиторий должен иметь следующую структуру веток:

###master
В ветке master находится текущее стабильное состояние проэкта. Иными словами, это live-версия.

###Ветки с фичами
В ветках с фичами программисты и верстальщики занимаются непосредственно программированием и версткой. В идеале на отдельную фичу нужно заводить отдельную ветку. Имя ветки по возможности должно совпадать с номером тикета в Redmine (например, 1245). Ветки с фичами должны создаваться на основе ветки master.
Коммиты в ветку с фичей должны сопровождаться комментарием в следующем формате:

`Capitalized, short (50 chars or less) summary`
`More detailed explanatory text, if necessary.  Wrap it to about 72`
`characters or so.  In some contexts, the first line is treated as the`
'subject of an email and the rest of the text as the body.  The blank`
'line separating the summary from the body is critical (unless you omit`
'the body entirely); tools like rebase can get confused if you run the`
'two together.`
'[re #1234]`

Все коммиты должны относиться к задаче на Redmine, поэтому в секции "detailed explanatory text" коммита нужно обязательно писать [re #xxxx], чтобы этот коммит автоматически к задаче привязался. Номер задачи — это мета-информация о коммите, поэтому не нужно его писать прямо в summary. Секция summary должна содержать краткое описание изменений, которые произошли в коммите. Фраза должна быть сформулирована в повелительном наклонении. Например, "Add reviews link to product page", или "Send email to customer after purchase".
Не подходят фразы типа "Product page", или "Code review", потому что по ним нельзя сказать, какие изменения были внесены в код.

###Ветки релизов (dev)
В dev-ветках находится код определенного релиза, над которым в данный момент идет работа. Ветки релизов должны создаваться на основе master. Правило именования: dev-x.y.z, где x.y.z — номер версии релиза. В dev-ветки нельзя коммитить напрямую, можно только мерджить из веток с фичами.
На каждый релиз должна создаваться отдельная дев-ветка. Это позволяет вести параллельную работу над двумя релизами (например, текущим спринтом и хотфиксом к предыдущему) независимо друг от друга.

###Ветки релизов (release candidate)
В rc-ветках находится код, который готовится к выходу в определенной версии. Ветки релизов должны создаваться на основе master. Правило именования: rc-x.y.z, где x.y.z — номер версии.
В rc-ветки нельзя коммитить напрямую, можно только мерджить.
У rc-ветки есть одна особенность: код из нее может попасть в master только путем fast-forward мерджа. Это значит, что если во время существования rc-1.3.0 в master были сделаны коммиты, то rc-1.3.0 придется удалить и создать заново на основе обновленного master-а. Это правило позволяет избежать мерджей кода и конфликтов при слиянии в master после тестирования кода на стэйджинге.
На каждый релиз должна создаваться отдельная rc-ветка.

###Тэги
При выходе новой версии в лайв тэгом помечается последний коммит ветки master. Правило именования: vx.y.z, где x.y.z — номер версии. Тэг должен сопровождаться комментарием в следующем формате:
Capitalized, short (50 chars or less) summary

Related issues:
* Feature #xxxx: Feature name
* Bug #yyyy: Bug name
* and all other features/bugs in this version
Если проект ведется на github-е, то релизы должны создаваться там же (релизы гитхаба — это небольшая надстройка над тэгами)

###Пул-реквесты
На проектах, где проводится код-ревью, весь код задачи по готовности должен оформляться в виде пул-реквеста на github из ветки с фичей в текущую dev-ветку.
Чтобы создать пул-реквест нужно:
Пойти на сайт с репозиторием (обычно это адрес вида https://github.com/OggettoWeb/...),
Нажать на кнопку "Pull Requests" в правом меню
Нажать на кнопку "New pull request"
Выбрать ветку с фичей и dev-ветку. Номер нужной дев-ветки можно узнать по номеру релиза из задачи в redmine, например, если задача прикреплена к релизу 0.11.0, то дев-ветка будет называться dev-0.11.0.
PR FEATURE DEV.png
После того, как ветки выбраны, нажать "Create Pull Request". В название пул-реквеста необходимо написать заголовок задачи (на английском), в описание можно написать любые пояснения по коду для ревьювера. Нельзя оставлять в названии пул-реквеста просто номер задачи из Redmine, должен быть понятный текст
После оформления названия, необходимо еще раз внимательно проверить коммиты, которые оторбажаются на github. Должны быть только коммиты, относящиеся к задаче. Нельзя, чтобы пул-реквест содержал посторонние мердж-коммиты. Если так происходит, обратитесь к лиду проекта.
Если все хорошо — нажать на "Create Pull Request" и получить прямую ссылку для предоставления на код-ревью
Примеры

Выпуск нового релиза
Допустим, на текущий момент последним релизом является 1.2.3. Новый релиз будет иметь номер 1.3.0 (добавляется единица ко второй цифре, третья цифра = 0).
Ответственным лицом создается ветка dev-1.3.0 и пушится в репозиторий.
Разработчики разрабатывают новые фичи в локальных ветках и по готовности делают пул-реквесты (для проектов с код ревью) в dev-1.3.0. Перед созданием пул-реквеста рекомендуется делать rebase с опцией squash, чтобы в релизной ветке получился один коммит со всем кодом фичи.
Ответственный лид делает код-ревью и мерджит пул-реквест в dev-1.3.0.
В процессе работы над релизом ветка dev-1.3.0 может заливаться на соответствующий дэв-сервер для тестирования. Когда наступает время тестирования релиза на staging-сервере (например, перед выпуском его в лайв), ответственными лицом создается ветка rc-1.3.0 на основе master и в нее мерджится dev-1.3.0. Ветка rc-1.3.0 деплоится на staging.
Когда релиз готов к выпуску в лайв ветка rc-1.3.0 мерджится в master, к последнему коммиту в master делается тэг v1.3.0 и live-сервер обновляется до этого тэга.
Выпуск хотфикса
Допустим, на текущий момент последним релизом является 1.2.3. Новый релиз-хотфикс будет иметь номер 1.2.4 (добавляется единица к третьей цифре).
Ответственным лицом создается ветка dev-1.2.4 и пушится в репозиторий.
Разработчики делают фикс в локальных ветках и по готовности делают пул-реквесты в fix-1.2.4 (для проектов с код ревью).
Ответственный лид делает код-ревью и мерджит пул-реквест в dev-1.2.4.
В процессе работы над фиксом ветка dev-1.2.4 может заливаться на дев-сервер для тестирования.
Когда наступает время тестирования релиза на staging-сервере (например, перед выпуском его в лайв), ответственными лицом создается ветка rc-1.2.4 на основе master и в нее мерджится dev-1.2.4. Ветка rc-1.2.4 деплоится на staging.
Когда релиз готов к выпуску в лайв ветка rc-1.2.4 мерджится в master, к последнему коммиту в master делается тэг v1.2.4 и live-сервер обновляется до этого тэга.